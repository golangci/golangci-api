// Code generated by genservices. DO NOT EDIT.
package subscription

import (
	"context"
	"runtime/debug"

	"github.com/go-kit/kit/endpoint"
	"github.com/golangci/golangci-api/pkg/app/returntypes"
	"github.com/golangci/golangci-api/pkg/endpoint/apierrors"
	"github.com/golangci/golangci-api/pkg/endpoint/endpointutil"
	"github.com/golangci/golangci-api/pkg/endpoint/request"
	"github.com/golangci/golangci-shared/pkg/logutil"
	"github.com/pkg/errors"
)

type ListRequest struct {
	Context *request.OrgID
}

type ListResponse struct {
	err error
	*WrappedSubInfo
}

func makeListEndpoint(svc Service, log logutil.Log) endpoint.Endpoint {
	return func(ctx context.Context, reqObj interface{}) (resp interface{}, err error) {

		req := reqObj.(ListRequest)

		reqLogger := log
		defer func() {
			if rerr := recover(); rerr != nil {
				reqLogger.Errorf("Panic occured")
				reqLogger.Infof("%s", debug.Stack())
				resp = ListResponse{
					err: errors.New("panic occured"),
				}
				err = nil
			}
		}()

		if err := endpointutil.Error(ctx); err != nil {
			log.Warnf("Error occurred during request context creation: %s", err)
			resp = ListResponse{
				err: err,
			}
			return resp, nil
		}

		rc := endpointutil.RequestContext(ctx).(*request.AuthorizedContext)
		reqLogger = rc.Log

		req.Context.FillLogContext(rc.Lctx)

		v, err := svc.List(rc, req.Context)
		if err != nil {
			rc.Log.Errorf("subscription.Service.List failed: %s", err)
			return ListResponse{err, v}, nil
		}

		return ListResponse{nil, v}, nil

	}
}

type GetRequest struct {
	Context *request.OrgSubID
}

type GetResponse struct {
	err error
	*returntypes.SubInfo
}

func makeGetEndpoint(svc Service, log logutil.Log) endpoint.Endpoint {
	return func(ctx context.Context, reqObj interface{}) (resp interface{}, err error) {

		req := reqObj.(GetRequest)

		reqLogger := log
		defer func() {
			if rerr := recover(); rerr != nil {
				reqLogger.Errorf("Panic occured")
				reqLogger.Infof("%s", debug.Stack())
				resp = GetResponse{
					err: errors.New("panic occured"),
				}
				err = nil
			}
		}()

		if err := endpointutil.Error(ctx); err != nil {
			log.Warnf("Error occurred during request context creation: %s", err)
			resp = GetResponse{
				err: err,
			}
			return resp, nil
		}

		rc := endpointutil.RequestContext(ctx).(*request.AuthorizedContext)
		reqLogger = rc.Log

		req.Context.FillLogContext(rc.Lctx)

		v, err := svc.Get(rc, req.Context)
		if err != nil {
			rc.Log.Errorf("subscription.Service.Get failed: %s", err)
			return GetResponse{err, v}, nil
		}

		return GetResponse{nil, v}, nil

	}
}

type CreateRequest struct {
	Context *request.OrgID
	Payload *SubPayload
}

type CreateResponse struct {
	err error
	*returntypes.SubInfo
}

func makeCreateEndpoint(svc Service, log logutil.Log) endpoint.Endpoint {
	return func(ctx context.Context, reqObj interface{}) (resp interface{}, err error) {

		req := reqObj.(CreateRequest)

		reqLogger := log
		defer func() {
			if rerr := recover(); rerr != nil {
				reqLogger.Errorf("Panic occured")
				reqLogger.Infof("%s", debug.Stack())
				resp = CreateResponse{
					err: errors.New("panic occured"),
				}
				err = nil
			}
		}()

		if err := endpointutil.Error(ctx); err != nil {
			log.Warnf("Error occurred during request context creation: %s", err)
			resp = CreateResponse{
				err: err,
			}
			return resp, nil
		}

		rc := endpointutil.RequestContext(ctx).(*request.AuthorizedContext)
		reqLogger = rc.Log

		req.Context.FillLogContext(rc.Lctx)
		req.Payload.FillLogContext(rc.Lctx)

		v, err := svc.Create(rc, req.Context, req.Payload)
		if err != nil {
			rc.Log.Errorf("subscription.Service.Create failed: %s", err)
			return CreateResponse{err, v}, nil
		}

		return CreateResponse{nil, v}, nil

	}
}

type UpdateRequest struct {
	Context *request.OrgSubID
	Payload *SubPayload
}

type UpdateResponse struct {
	err error
}

func makeUpdateEndpoint(svc Service, log logutil.Log) endpoint.Endpoint {
	return func(ctx context.Context, reqObj interface{}) (resp interface{}, err error) {

		req := reqObj.(UpdateRequest)

		reqLogger := log
		defer func() {
			if rerr := recover(); rerr != nil {
				reqLogger.Errorf("Panic occured")
				reqLogger.Infof("%s", debug.Stack())
				resp = UpdateResponse{
					err: errors.New("panic occured"),
				}
				err = nil
			}
		}()

		if err := endpointutil.Error(ctx); err != nil {
			log.Warnf("Error occurred during request context creation: %s", err)
			resp = UpdateResponse{
				err: err,
			}
			return resp, nil
		}

		rc := endpointutil.RequestContext(ctx).(*request.AuthorizedContext)
		reqLogger = rc.Log

		req.Context.FillLogContext(rc.Lctx)
		req.Payload.FillLogContext(rc.Lctx)

		err = svc.Update(rc, req.Context, req.Payload)
		if err != nil {
			if !apierrors.IsErrorLikeResult(err) {
				rc.Log.Errorf("subscription.Service.Update failed: %s", err)
			}
			return UpdateResponse{err}, nil
		}

		return UpdateResponse{nil}, nil

	}
}

type DeleteRequest struct {
	Context *request.OrgSubID
}

type DeleteResponse struct {
	err error
}

func makeDeleteEndpoint(svc Service, log logutil.Log) endpoint.Endpoint {
	return func(ctx context.Context, reqObj interface{}) (resp interface{}, err error) {

		req := reqObj.(DeleteRequest)

		reqLogger := log
		defer func() {
			if rerr := recover(); rerr != nil {
				reqLogger.Errorf("Panic occured")
				reqLogger.Infof("%s", debug.Stack())
				resp = DeleteResponse{
					err: errors.New("panic occured"),
				}
				err = nil
			}
		}()

		if err := endpointutil.Error(ctx); err != nil {
			log.Warnf("Error occurred during request context creation: %s", err)
			resp = DeleteResponse{
				err: err,
			}
			return resp, nil
		}

		rc := endpointutil.RequestContext(ctx).(*request.AuthorizedContext)
		reqLogger = rc.Log

		req.Context.FillLogContext(rc.Lctx)

		err = svc.Delete(rc, req.Context)
		if err != nil {
			if !apierrors.IsErrorLikeResult(err) {
				rc.Log.Errorf("subscription.Service.Delete failed: %s", err)
			}
			return DeleteResponse{err}, nil
		}

		return DeleteResponse{nil}, nil

	}
}
